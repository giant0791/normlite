normlite.sql.dml
================

.. py:module:: normlite.sql.dml






Module Contents
---------------

.. py:class:: Insert

   Bases: :py:obj:`normlite.sql.base.Executable`


   Provide the interface for all executable SQL statements.

   This base class implements the command design pattern for execution of clause elements.
   The :meth:`execute` method has a base implementation of the execution flow that can be used as default implementation
   in the subclasses.

   It provides a post execution hook with the :meth:`_post_exec` that is intended to be optionally implemented in
   the subclasses.

   .. versionadded:: 0.7.0
       This bas class fully supports the connection-driven execution flow of SQL statements.


   .. py:attribute:: __visit_name__
      :value: 'insert'


      Provide the SQL ``INSERT`` node to create a new row in the specified table.

      This class provide a generative implementation of the SQL ``INSERT`` node to be executed on a
      :class:`normlite.connection.Connection`.

      Usage:
          >>> # create a new insert statement for the table students
          >>> stmt = Insert(students)
          ...
          >>> # create a new insert statement and specify the ``RETURNING`` clause.
          >>> stmt = Insert(students).returning(students.c.id, students.c.name)
          ...
          >>> # specify the values to be inserted as keyword arguments
          >>> stmt.values(id=123456, name='Isaac Newton', grade='B')
          ...
          >>> # specify the values to be inserted as dictionary
          >>> stmt.values({'id': 123456, 'name': 'Isaac Newton', 'grade': 'B'})
          ...
          >>> # specify the values to be inserted as tuple
          >>> stmt.values((123456, 'Isaac Newton', 'B'))

      .. important::

         The :class:`Insert` has always by default the Notion specific columns as ``RETURNING`` clause.
         That is, the :class:`normlite.CursorResult` methods of an insert statement always returns rows with the
         columns corresponding to the Notion specific ones.
         You specify the :meth:`Insert.returning()` to get additional columns in the rows returned by the
         :class:`normlite.CursorResult` methods.

      .. note::

         The :class:`Insert`  can also be constructed without specifying the values.
         In this case, the parameters passed in the :meth:`normlite.connection.Connection.execute()` are bound
         as ``VALUES`` clause parameters at execution time.

      .. versionchanged:: 0.7.0 The old construct has been completely redesigned and refactored.
          Now, the new class provides all features of the SQL ``INSERT`` statement.


   .. py:attribute:: _values
      :type:  types.MappingProxyType
      :value: None


      The immutable mapping holding the values.


   .. py:attribute:: _table
      :type:  normlite.sql.schema.Table
      :value: None


      The table object to insert a new row to.


   .. py:attribute:: _returning
      :value: ()


      The tuple holding the Notion specific columns.


   .. py:method:: _set_table(table: normlite.sql.schema.Table) -> None


   .. py:method:: get_table() -> normlite.sql.schema.ReadOnlyColumnCollection

      Return a collection of columns this clause element refers to.



   .. py:method:: values(*args: Union[dict, Sequence[Any]], **kwargs: Any) -> Self

      Provide the ``VALUES`` clause to specify the values to be inserted in the new row.

      :raises ArgumentError: If both positional and keyword arguments are passes, or
          if not enough values are supplied for all columns, or if values are passed
          with a class that is neither a dictionary not a tuple.

      :returns: This instance for generative usage.
      :rtype: Self



   .. py:method:: returning(*cols: normlite.sql.schema.Column) -> Self

      Provide the ``RETURNING`` clause to specify the column to be returned.

      :raises ArgumentError: If a specified column does not belong to the table this insert statement
          is applied to.

      :returns: This instance for generative usage.
      :rtype: Self



   .. py:method:: _process_dict_values(dict_arg: dict) -> types.MappingProxyType


.. py:function:: insert(table: normlite.sql.schema.Table) -> Insert

   Construct an insert statement.

   This class constructs an SQL ``INSERT`` statement capable of inserting rows
   to this table.

   .. versionchanged:: 0.7.0
       Now, it uses the :class:`normlite.sql.schema.Table` as table object.

   :returns: A new insert statement for this table.
   :rtype: Insert


