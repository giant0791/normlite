normlite.engine.context
=======================

.. py:module:: normlite.engine.context

.. autoapi-nested-parse::

   Provide key runtime abstraction for executing SQL statements.

   The design of SQL statement execution separates responsibilities cleanly using the following key classes:

   .. list-table:: SQL Statement Execution Design
      :header-rows: 1
      :widths: 23 77
      :class: longtable

      * - Class
        - Responsibility
      * - :class:`normlite.sql.base.Executable`
        - Describes *what* to execute (e.g. :class:`normlite.sql.ddl.CreateTable`, :class:`normlite.sql.dml.Insert`)
          :class:`notiondbapi._model.NotionPage` for more details).
      * - :class:`normlite.sql.base.SQLCompiler`
        - Translates the :class:`normlite.sql.base.Executable` into a serializable payload.
      * - :class:`ExecutionContext`
        - Orchestrates binding, compilation, and result setup.
      * - :class:`normlite.engine.base.Connection`
        - Owns the DBAPI connection and *executes* statements.
      * - :class:`normlite.engine.base.Engine`
        - Factory for :class:`normlite.sql.base.SQLCompiler` and :class:`Connection`.


   .. versionadded:: 0.7.0
       :class:`ExecutionContext` orchestrates binding, compilation, and result setup.





Module Contents
---------------

.. py:class:: ExecutionContext(dbapi_cursor: normlite.notiondbapi.dbapi2.Cursor, compiled: normlite.sql.base.Compiled)

   Orchestrate binding, compilation, and result setup.

   This class manages the key activities for the execution of SQL statements.
   It binds dynamically the parameters at runtime prior to execution using the owned :class:`normlite.sql.Compiled` object.
   After execution, it sets up the :class:`normlite.cursor.CursorResult` object to be returned using the owned :class:`normlite.notiondbapi.dbapi2.Cursor`
   (which contains the result set of the executed statement).

   .. versionadded:: 0.7.0
       :meth:`_bind_params()` expects that parameters have been provided for all columns.
       It raises :exc:`normlite.exceptions.ArgumentError` if this is not the case.



   .. py:attribute:: _dbapi_cursor

      The DBAPI cursor holding the result set of the executed statement.


   .. py:attribute:: _compiled

      The compiled statement.


   .. py:attribute:: _element

      The statement object.


   .. py:attribute:: _binds

      The parameters to be bound.


   .. py:attribute:: _result
      :value: None


      The constructed :class:`normlite.cursor.CursorResult` to be returned as execution result.


   .. py:method:: setup() -> None

      Perform value binding and type adaptation before execution.



   .. py:method:: _bind_params(template: dict, params: dict) -> dict

      Helper for binding parameters at runtime.



   .. py:method:: _setup_cursor_result(cursor: normlite.notiondbapi.dbapi2.Cursor) -> normlite.cursor.CursorResult

      Setup the cursor result to be returned.



